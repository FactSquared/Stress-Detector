<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="31,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T17U3">imf</span> = emd(<span class="var type1" id="S3T2U6">x</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="31,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="31,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T2:U3"><span class="var type1" id="S3T2U9">x</span>   = <span class="mxinfo " id="T2:U5">transpose(<span class="mxinfo " id="T18:U6"><span class="var type1" id="S3T2U13">x</span>(:)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T17:U8"><span class="var type1" id="S2T17U17">imf</span> = <span class="mxinfo " id="T17:U10">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo " id="T5:U11">~<span class="mxinfo " id="T1:U12"><span class="fcn" id="F77N6:B23">ismonotonic</span>(<span class="var type1" id="S3T2U24">x</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="31,6" id="srcline6"> 6</a></span><span class="line">   <span class="mxinfo " id="T2:U14"><span class="var type1" id="S6T2U27">x1</span> = <span class="var type1" id="S3T2U28">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,7" id="srcline7"> 7</a></span><span class="line">   <span class="mxinfo " id="T1:U17"><span class="var type1" id="S7T1U31">sd</span> = <span class="mxinfo " id="T1:U19">Inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,8" id="srcline8"> 8</a></span><span class="line">   <span class="keyword">while</span> (<span class="mxinfo " id="T5:U20"><span class="var type1" id="S7T1U38">sd</span> &gt; <span class="mxinfo " id="T1:U22">0.1</span></span>) | <span class="mxinfo " id="T5:U23">~<span class="mxinfo " id="T1:U24"><span class="fcn" id="F190N5:B42">isimf</span>(<span class="var type1" id="S6T2U43">x1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="31,9" id="srcline9"> 9</a></span><span class="line">      <span class="mxinfo " id="T19:U26"><span class="var type1" id="S10T19U46">s1</span> = <span class="mxinfo " id="T19:U28"><span class="fcn" id="F235N4:B48">getspline</span>(<span class="var type1" id="S6T2U49">x1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,10" id="srcline10">10</a></span><span class="line">      <span class="mxinfo " id="T19:U30"><span class="var type1" id="S12T19U52">s2</span> = <span class="mxinfo " id="T19:U32">-<span class="mxinfo " id="T19:U33"><span class="fcn" id="F235N4:B55">getspline</span>(<span class="mxinfo " id="T2:U34">-<span class="var type1" id="S6T2U57">x1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,11" id="srcline11">11</a></span><span class="line">      <span class="mxinfo " id="T2:U36"><span class="var type1" id="S13T2U60">x2</span> = <span class="mxinfo " id="T2:U38"><span class="var type1" id="S6T2U62">x1</span>-<span class="mxinfo " id="T19:U40">(<span class="mxinfo " id="T19:U41"><span class="var type1" id="S10T19U66">s1</span>+<span class="var type1" id="S12T19U67">s2</span></span>)/2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,12" id="srcline12">12</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="31,13" id="srcline13">13</a></span><span class="line">      <span class="mxinfo " id="T1:U44"><span class="var type1" id="S7T1U71">sd</span> = <span class="mxinfo " id="T1:U46"><span class="mxinfo " id="T1:U47">sum(<span class="mxinfo " id="T2:U48">(<span class="mxinfo " id="T2:U49"><span class="var type1" id="S6T2U78">x1</span>-<span class="var type1" id="S13T2U79">x2</span></span>).^2</span>)</span>/<span class="mxinfo " id="T1:U52">sum(<span class="mxinfo " id="T2:U53"><span class="var type1" id="S6T2U84">x1</span>.^2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,14" id="srcline14">14</a></span><span class="line">      <span class="mxinfo " id="T2:U55"><span class="var type1" id="S6T2U88">x1</span> = <span class="var type1" id="S13T2U89">x2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,15" id="srcline15">15</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="31,16" id="srcline16">16</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="31,17" id="srcline17">17</a></span><span class="line">   <span class="mxinfo " id="T17:U58"><span class="var type1" id="S2T17U93"><span class="message error" id="M20F54C">imf</span></span></span>{end+1} = <span class="var type0" id="S6T0U98">x1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,18" id="srcline18">18</a></span><span class="line">   <span class="mxinfo " id="T2:U59"><span class="var type1" id="S3T2U101">x</span>          = <span class="mxinfo " id="T2:U61"><span class="var type1" id="S3T2U103">x</span>-<span class="var type1" id="S6T2U104">x1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,19" id="srcline19">19</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="31,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T17:U64"><span class="var type1" id="S2T17U108"><span class="message error" id="M21F54C">imf</span></span></span>{end+1} = <span class="var type0" id="S3T0U113">x</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="31,21" id="srcline21">21</a></span><span class="line"></span></span>
</pre>
